# Документация по запуску и использованию Book Parser API-сервиса

## 1. Запуск сервиса

Для запуска микросервиса используйте следующую команду:

```bash
uvicorn src.book_parser.main:app --host 0.0.0.0 --port 8001 --reload
```

### Параметры команды:
- `src.book_parser.main:app` – путь к FastAPI приложению.
- `--host 0.0.0.0` – делает сервис доступным на всех сетевых интерфейсах.
- `--port 8001` – указывает порт для запуска сервиса (можно изменить при необходимости).
- `--reload` – включает автоматическую перезагрузку сервиса при изменении кода (только для разработки).

После успешного запуска в консоли появится сообщение вида:

```
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
```

Сервис теперь доступен по адресу `http://127.0.0.1:8001` (или `http://<ваш-ip>:8001` при работе на сервере).

---

## 2. Реализованные API-методы

Сервис предоставляет API для получения структурированной информации из книги:

### **1. Получение списка частей книги**
- **Метод:** `GET`
- **URL:** `/api/parts`
- **Описание:** Возвращает список всех частей книги с их описаниями.

**Пример запроса:**
```bash
curl http://127.0.0.1:8001/api/parts
```

**Пример ответа:**
```json
{
   "parts": [
       {
           "part_number": "1",
           "title": "Название части",
           "summary": "Краткое описание",
           "key_points": "Ключевой момент 1, Ключевой момент 2"
       }
   ]
}
```

### **2. Получение глав для конкретной части**
- **Метод:** `GET`
- **URL:** `/api/parts/{part_number}/chapters`
- **Описание:** Возвращает список глав для указанной части книги.

**Пример запроса:**
```bash
curl http://127.0.0.1:8001/api/parts/1/chapters
```

**Пример ответа:**
```json
{
   "chapters": [
       {
           "chapter_number": "1.1",
           "title": "Название главы",
           "summary": "Описание главы",
           "key_points": "Ключевой момент 1, Ключевой момент 2"
       }
   ]
}
```

### **3. Получение подглав**
- **Метод:** `GET`
- **URL:** `/api/parts/{part_number}/chapters/{chapter_number}/subchapters`
- **Описание:** Возвращает список подглав для указанной главы.

**Пример запроса:**
```bash
curl http://127.0.0.1:8001/api/parts/1/chapters/1/subchapters
```

**Пример ответа:**
```json
{
   "subchapters": [
       {
           "subchapter_number": "1.1.1",
           "title": "Название подглавы",
           "summary": "Описание подглавы",
           "key_points": "Ключевой момент 1, Ключевой момент 2"
       }
   ]
}
```

### **4. Получение содержимого подглавы**
- **Метод:** `GET`
- **URL:** `/api/subchapters/{subchapter_number}/content`
- **Описание:** Возвращает текстовое содержимое указанной подглавы.

**Пример запроса:**
```bash
curl http://127.0.0.1:8001/api/subchapters/1.1.1/content
```

**Пример ответа:**
```json
{
   "content": "Текстовое содержимое подглавы..."
}
```

---

## 3. Тестирование сервиса

### Базовое тестирование
Тесты расположены в директории `tests/book_parser/` и включают:
- `test_app.py` - тесты основных эндпоинтов
- `test_services.py` - тесты базовых сервисов

### Запуск тестов
Есть несколько способов запуска тестов:

1. Запуск всех тестов:
```bash
pytest tests/book_parser/
```

2. Запуск конкретного тестового файла:
```bash
pytest tests/book_parser/test_app.py
```

3. Запуск с подробным выводом:
```bash
pytest -v tests/book_parser/
```

4. Запуск с отключением предупреждений:
```bash
pytest -p no:warnings tests/book_parser/
```

### Основные тестовые сценарии:
1. Тесты API эндпоинтов (`test_app.py`):
  - Проверка доступности всех эндпоинтов
  - Проверка корректности форматов ответов
  - Проверка обработки ошибок
  
2. Тесты сервисов (`test_services.py`):
  - Проверка загрузки JSON файлов
  - Проверка базового парсинга данных
  - Проверка обработки ошибок

### Требования для запуска тестов
Необходимо установить зависимости:
```bash
pip install pytest pytest-asyncio httpx
```

---

## 4. Конфигурация

Сервис использует следующие настройки из файла `config.py`:
- `know_map_path` - путь к файлу с картой знаний
- `kniga_path` - путь к файлу с содержимым книги

Пути можно изменить через переменные окружения или файл `.env`.

---

## 5. Дополнительно
- Сервис реализован на **FastAPI** и работает с **Uvicorn**
- Использует Pydantic для валидации данных
- Включает логирование операций

Для удобного тестирования API можно использовать **Swagger UI**, доступный по адресу:
```
http://127.0.0.1:8001/docs
```