# TODO: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Summary –¥–ª—è –°—Ç—Ä–∞–Ω–∏—Ü

## üéØ –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `summary` –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ `kniga_full_content.json` —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM.

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- Summary –ø–æ–¥–≥–ª–∞–≤ –∏–∑ `know_map_full.json` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- LLM –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### ‚ùå –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
- Summary –¥–ª—è –∫–∞–∂–¥–æ–π –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ `kniga_full_content.json`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è summary —Å –ø–æ–º–æ—â—å—é LLM
- –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
```json
{
  "pageNumber": 47,
  "content": "–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã...",
  "metadata": {...}
}
```

### –¢—Ä–µ–±—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
```json
{
  "pageNumber": 47,
  "content": "–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã...",
  "summary": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)",
  "metadata": {...}
}
```

## üìù –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ summary

**–§–∞–π–ª:** `scripts/generate_page_summaries.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ß–∏—Ç–∞–µ—Ç `kniga_full_content.json`
- –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç summary —á–µ—Ä–µ–∑ GigaChat API
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å summary

**–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ summary:**
```
–°–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–Ω–∏–≥–∏:
[–°–û–î–ï–†–ñ–ò–ú–û–ï –°–¢–†–ê–ù–ò–¶–´]

–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- –°—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö –∏–¥–µ—è—Ö
- –ú–∞–∫—Å–∏–º—É–º 150 —Å–ª–æ–≤
- –ü–æ–Ω—è—Ç–Ω–æ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–Ω–∏–≥–∏
```

### –≠—Ç–∞–ø 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—É—â–∏–π `kniga_full_content.json`
2. –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
   - –ò–∑–≤–ª–µ—á—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
   - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å summary —á–µ—Ä–µ–∑ LLM
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `summary`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å (–∫–∞–∂–¥—ã–µ 10 —Å—Ç—Ä–∞–Ω–∏—Ü)
3. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –ø—Ä–µ—Ä–≤–∞–Ω–Ω–æ–≥–æ –º–µ—Å—Ç–∞

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Å—Ç—ã:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ JSON
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ generated summary
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã LLM —Å –Ω–æ–≤—ã–º–∏ summary vs —Å—Ç–∞—Ä—ã–º–∏

### –≠—Ç–∞–ø 4: –ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–¥–∞

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å `fetch_subchapter_text()` –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É
2. –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
   - `get_subchapter_summary_from_knowmap()`
   - `fetch_subchapter_text_original()` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å
3. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
# scripts/quick_summary_test.py
import json
from src.llm_search_and_answer.services import create_llm_client

def generate_summary_for_page(content: str) -> str:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç summary –¥–ª—è –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã."""
    client = create_llm_client()
    
    response = client.chat.completions.create(
        model="GigaChat-Max",
        messages=[
            {"role": "system", "content": "–°–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–Ω–∏–≥–∏."},
            {"role": "user", "content": f"–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:\n{content}"}
        ],
        temperature=0.3
    )
    
    return response.choices[0].message.content

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø–µ—Ä–≤—ã—Ö 5 —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **–¢–æ—á–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤:** +30% –±–ª–∞–≥–æ–¥–∞—Ä—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- **–ì–∏–±–∫–æ—Å—Ç—å:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å summary

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏:
- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ summary (—Ü–µ–ª—å: <5 —Å–µ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
- –ö–∞—á–µ—Å—Ç–≤–æ summary (–æ—Ü–µ–Ω–∫–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ 1-5)
- –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤ LLM (A/B —Ç–µ—Å—Ç)

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞

### –†–µ—Å—É—Ä—Å—ã:
- **–í—Ä–µ–º—è:** ~4-6 —á–∞—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ + 2-3 —á–∞—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- **API –≤—ã–∑–æ–≤—ã:** ~145 –≤—ã–∑–æ–≤–æ–≤ –∫ GigaChat (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç—Ä–∞–Ω–∏—Ü)
- **–î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ:** +~2MB –¥–ª—è summary –¥–∞–Ω–Ω—ã—Ö

### –†–∏—Å–∫–∏:
- **–õ–∏–º–∏—Ç—ã API:** –í–æ–∑–º–æ–∂–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å batch –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ö–∞—á–µ—Å—Ç–≤–æ summary:** –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:** 145 —Å—Ç—Ä–∞–Ω–∏—Ü √ó 5 —Å–µ–∫ = ~12 –º–∏–Ω—É—Ç

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –Ω–∞—á–∞–ª—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —É–ª—É—á—à–µ–Ω–∏–µ –¥–∞—Å—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –°–æ–∑–¥–∞—Ç—å `scripts/generate_page_summaries.py` –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 5-10 —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö