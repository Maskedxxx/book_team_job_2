# Документация по запуску и использованию GigaChat API-сервиса

## 1. Запуск сервиса

Для запуска микросервиса используйте следующую команду:

```bash
uvicorn src.gigachat_init.main:app --host 0.0.0.0 --port 8000 --reload
```

### Параметры команды:
- `src.gigachat_init.main:app` – путь к FastAPI приложению.
- `--host 0.0.0.0` – делает сервис доступным на всех сетевых интерфейсах.
- `--port 8000` – указывает порт для запуска сервиса (можно изменить при необходимости).
- `--reload` – включает автоматическую перезагрузку сервиса при изменении кода (только для разработки).

После успешного запуска в консоли появится сообщение вида:

```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

Сервис теперь доступен по адресу `http://127.0.0.1:8000` (или `http://<ваш-ip>:8000` при работе на сервере).

---

## 2. Реализованные API-методы

Сервис предоставляет API для работы с токенами GigaChat:

### **1. Получение актуального токена**
- **Метод:** `GET`
- **URL:** `/token`
- **Описание:** Возвращает текущий токен GigaChat.

**Пример запроса:**
```bash
curl http://127.0.0.1:8000/token
```

**Пример ответа:**
```json
{
    "access_token": "abcdef1234567890"
}
```

---

### **2. Получение информации о токене**
- **Метод:** `GET`
- **URL:** `/token/info`
- **Описание:** Возвращает информацию о текущем токене (действителен ли он и когда истекает).

**Пример запроса:**
```bash
curl http://127.0.0.1:8000/token/info
```

**Пример ответа:**
```json
{
    "is_valid": true,
    "expires_at": "2025-02-18 12:34:56"
}
```

---

### **3. Принудительное обновление токена**
- **Метод:** `POST`
- **URL:** `/token/refresh`
- **Описание:** Обновляет токен GigaChat принудительно.

**Пример запроса:**
```bash
curl -X POST http://127.0.0.1:8000/token/refresh
```

**Пример ответа:**
```json
{
    "message": "Токен успешно обновлен",
    "access_token": "new_token_12345"
}
```

---

## 3. Использование API в других сервисах

### **Пример получения токена в Python**

```python
import requests

response = requests.get("http://127.0.0.1:8000/token")
data = response.json()
print(f"Текущий токен: {data['access_token']}")
```

### **Пример обновления токена в Python**

```python
response = requests.post("http://127.0.0.1:8000/token/refresh")
data = response.json()
print(f"Обновленный токен: {data['access_token']}")
```

---

## 4. Тестирование сервиса

### Структура тестов
Тесты расположены в директории `tests/gigachat/` и включают:
- `test_auth.py` - тесты аутентификации и работы с токенами
- `test_client.py` - тесты клиента GigaChat

### Запуск тестов
Есть несколько способов запуска тестов:

1. Запуск всех тестов:
```bash
pytest tests/gigachat/
```

2. Запуск конкретного тестового файла:
```bash
pytest tests/gigachat/test_auth.py
```

3. Запуск с подробным выводом:
```bash
pytest -v tests/gigachat/
```

4. Запуск с отключением предупреждений:
```bash
pytest -p no:warnings tests/gigachat/
```

### Основные тестовые сценарии:
1. Тесты аутентификации (`test_auth.py`):
   - Получение токена GigaChat
   - Проверка валидности токена
   - Автоматическое обновление токена
   
2. Тесты клиента (`test_client.py`):
   - Инициализация клиента
   - Работа с токеном
   - Проверка информации о токене


## Дополнительно
- Сервис реализован на **FastAPI** и работает с **Uvicorn**.
- Используется клиент `GigaChatClient` для получения и обновления токенов.
- Логирование операций включено в сервис (см. `src/gigachat_init/logger.py`).

Для удобного тестирования API можно использовать **Postman** или **Swagger UI**, который доступен по адресу:
```
http://127.0.0.1:8000/docs
```

