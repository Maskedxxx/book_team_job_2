#!/bin/bash
# test_subchapters.sh - –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–≥–ª–∞–≤

echo "üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–≥–ª–∞–≤ LLM –ø–∞–π–ø–ª–∞–π–Ω–∞"
echo "======================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
if [ ! -f "main.py" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º book_parser
if ! curl -s http://127.0.0.1:8001/parser/parts > /dev/null; then
    echo "‚ùå –°–µ—Ä–≤–∏—Å book_parser –Ω–µ –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 8001)"
    echo "   –ó–∞–ø—É—Å—Ç–∏—Ç–µ: python main.py"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º gigachat_init  
if ! curl -s http://127.0.0.1:8010/token/ > /dev/null; then
    echo "‚ùå –°–µ—Ä–≤–∏—Å gigachat_init –Ω–µ –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 8010)"
    echo "   –ó–∞–ø—É—Å—Ç–∏—Ç–µ: python main.py"
    exit 1
fi

echo "‚úÖ –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã"

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
echo "üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
python tests/test_subchapters_pipeline.py

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
if [ $? -eq 0 ]; then
    echo ""
    echo "üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!"
    echo "   –ü–æ–¥–≥–ª–∞–≤—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é"
else
    echo ""
    echo "üí• –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã!"
    echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ –≤—ã—à–µ –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"
fi